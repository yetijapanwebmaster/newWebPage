<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YETI - Yamanashi English Teachers International</title>
    <link rel="stylesheet" href="yeti.css" >
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  </head>
  <body>
    <!-- Navbar -->
    <div id="topnav" class="nav">
      <a id="homelink" href="index.html"><span class="material-icons">filter_hdr</span> YETI</a>
      <div class="hamburger" onclick="myFunction(this);">
        <div class="bar1"></div>
        <div class="bar2"></div>
        <div class="bar3"></div>
      </div>
      <!-- Navbar links -->
      <!-- Current page denoted by 'active' class -->
      <a href="index.html">Home</a>
      <a href="#" class="active">Events</a>
      <a href="blog/">News</a>
      <a href="#">Yamanashi</a>
      <a href="about.html">About</a>
      <a href="#">FAQ</a>
    </div>

    <div class="events col-12">
        <h2>Upcoming Events</h2>
        <div id="eventCal">
        </div>
        <!-- <a href="https://www.facebook.com/groups/yamanashiyeti/"><button class="fb-btn col-8">Find out more on Facebook!</button></a>-->

        <h2>Seasonal Events:</h2>
        <a href="https://www.google.com">
          <div id="eventskitrip" class="events-yr col-12">
            <h3>YETI Ski Trip</h3>

            <div class="col-12">Click for more info!</div>
          </div>
        </a>
        <a href="https://www.google.com">
          <div id="eventhalloween" class="events-yr col-12">
            <h3>Halloween Party</h3>

            <div class="col-12">Click for more info!</div>
          </div>
        </a>
     </div>


    <script>
        function myFunction(x) {
          x.classList.toggle("change");

          var x = document.getElementById("topnav");
          if (x.className === "nav") {
            x.className += " dropdown";
          } else {
            x.className = "nav";
          }
        }
    </script>

    <script>
          window.fbAsyncInit = function() {
            FB.init({
              appId            : '352438862789553',
              autoLogAppEvents : true,
              xfbml            : true,
              version          : 'v8.0'
            });

            FB.getLoginStatus(function(response) {
              if (response.status === 'connected') {
                var accessToken = response.authResponse.accessToken;
                FB.api(
                    "/1253304111694340/events",
                    "GET",
                    {"fields":"name,start_time,end_time,cover"},
                    function (response) {
                      if (response && !response.error) {
                        console.log(JSON.stringify(response));
                        setEvents(response.data);
                        // console.log(search(respons.data,''));
                      }
                      else{
                        console.log('Not Replying:');
                        console.log(JSON.stringify(response));
                      }
                    }
                  );
              }
            } );
            };

            //Uses event data and inputs into 'event-sm' class. Sets the picture, Event name, and also the Date and time of the event

            function setEvents(data){
              var results = [];
              var i;

              if(data != -1){
                var fbEvents = document.getElementById('eventCal');
                // fbEvents = document.getElementsByClassName('events-sm');
                for(i=0;i<data.length;i++){

                  //  Creates Div to hold Event information
                  var eventSm = document.createElement('DIV');
                  eventSm.className = "events-sm col-12";

                  var eventSmImg = document.createElement('IMG');
                  eventSmImg.className = "col-5 col-m-5";
                  eventSmImg.src = data[i].cover.source;
                  eventSm.appendChild(eventSmImg);


                  //Create Text Div
                  var eventSmText = document.createElement('DIV');
                  eventSmText.className = "col-m-7";

                  var eventSmName = document.createElement('H3');
                  eventSmName.innerText = data[i].name;
                  eventSmText.appendChild(eventSmName);

                  var eventSmDate = document.createElement('H4');
                  //Fetches Formatted Date Value
                  eventSmDate.innerText = formatDate(data[i].start_time,data[i].end_time);
                  eventSmText.appendChild(eventSmDate);

                  eventSm.appendChild(eventSmText);
                  fbEvents.appendChild(eventSm);
                }
              }
            };

            // Formats Date and Time. In the case of matching Dates for the startTime and endTime the endTime date is dropped

            function formatDate(startTime, endTime){
              var start = startTime.split(/\T|\+/);
              var end = endTime.split(/\T|\+/);
              var formattedDate;
              if(start[0] === end[0])
                {
                  formattedDate = parseDate(start[0]) + ' @ ' + start[1].substr(0,5) + ' - ' + end[1].substr(0,5);
                }
              else{
                formattedDate = parseDate(start[0]) + ' @ ' + start[1].substr(0,5) + ' - ' + parseDate(end[0]) + ' @ ' + end[1].substr(0,5);
              }
              return formattedDate;
            };

            //Takes date in YY-MM-DD format and parses into english readable format ex. 'January 10, 1995.'
            function parseDate(date){
              tmpDate = date.split('-');
              switch(tmpDate[1]){
                case '01':
                  tmpDate[1] = 'January';
                break;
                case '02':
                  tmpDate[1] = 'February';
                break;
                case '03':
                  tmpDate[1] = 'March';
                break;
                case '04':
                  tmpDate[1] = 'April';
                break;
                case '05':
                  tmpDate[1] = 'May';
                break;
                case '06':
                  tmpDate[1] = 'June';
                break;
                case '07':
                  tmpDate[1] = 'July';
                break;
                case '08':
                  tmpDate[1] = 'August';
                break;
                case '09':
                  tmpDate[1] = 'September';
                break;
                case '10':
                  tmpDate[1] = 'October';
                break;
                case '11':
                  tmpDate[1] = 'November';
                break;
                case '12':
                  tmpDate[1] = 'December';
                break;
              }
              return tmpDate[1] + ' ' + tmpDate[2] + ', ' + tmpDate[0];

            };



        </script>

        <script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js"></script>


  </body>
</html>
